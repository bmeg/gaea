#!/usr/bin/env python

import argparse
import subprocess

def migrate(args):
    subprocess.call('sbt --error "command/run migrate --config ' + args.config + '"', shell=True)

def ingest(args):
    shell = ['sbt "command/run ingest --config ', args.config]
    # shell = ['sbt --error "command/run ingest --config ', args.config]
    print(args.url)
    print(args.file)
    print(args.kafka)
    if args.url:
        shell = shell + [' --url ', args.url]
    if args.file:
        shell = shell + [' --file ', args.file]
    if args.kafka:
        shell = shell + [' --kafka ', args.kafka]
    shell.append('"')
    command = reduce(lambda x, y: x + y, shell)
    print(command)
    subprocess.call(command, shell=True)
    print('ingest ' + str(args))

def start(args):
    try:
        subprocess.call('sbt --error "command/run start --config ' + args.config + '"', shell=True)
    except:
        None

def parse_args():
    parser = argparse.ArgumentParser()
    sub = parser.add_subparsers()

    migrate_parser = sub.add_parser('init')
    migrate_parser.add_argument('--config', default='resources/config/gaia.yaml')
    migrate_parser.set_defaults(func=migrate)

    ingest_parser = sub.add_parser('ingest')
    ingest_parser.add_argument('--config', default='resources/config/gaia.yaml')
    ingest_parser.add_argument('--url')
    ingest_parser.add_argument('--file')
    ingest_parser.add_argument('--kafka')
    ingest_parser.set_defaults(func=ingest)

    start_parser = sub.add_parser('start')
    start_parser.add_argument('--config', default='resources/config/gaia.yaml')
    start_parser.set_defaults(func=start)

    return parser.parse_args()

if __name__ == '__main__':
    args = parse_args()
    args.func(args)
